<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1a - Osnove Islama</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lora:wght@400;600&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Lora', serif;
            background: linear-gradient(135deg, #064e3b 0%, #0f766e 50%, #065f46 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        .quiz-header { text-align: center; margin-bottom: 1rem; }
        
        .quiz-icon {
            width: 100px;
            height: auto;
            margin-bottom: 0.5rem;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle { font-size: 1.2rem; color: #d1fae5; }
        
        .welcome-msg {
            text-align: center;
            margin-bottom: 1rem;
            padding: 10px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            display: none;
        }
        .welcome-msg.show { display: block; }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .back-link {
            color: #fbbf24;
            text-decoration: none;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        .back-link:hover { color: #f59e0b; }
        
        .progress-bar-container {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin: 0 1rem;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #fbbf24, #f59e0b);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .question-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .question-text {
            font-size: 1.4rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        
        .options { display: flex; flex-direction: column; gap: 1rem; }
        
        .option-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-family: 'Lora', serif;
        }
        
        .option-btn:hover:not(:disabled) {
            background: rgba(34, 197, 94, 0.4);
            transform: translateX(10px);
        }
        
        .option-btn.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
        }
        
        .option-btn.incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #ef4444;
        }
        
        .option-btn.show-correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            opacity: 0.7;
        }
        
        .option-btn.faded { opacity: 0.5; }
        .option-btn:disabled { cursor: not-allowed; }
        
        .result-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .result-emoji { font-size: 4rem; margin-bottom: 1rem; }
        .result-message { font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 1rem; }
        .result-score { font-size: 3rem; font-weight: 700; color: #fbbf24; margin-bottom: 0.5rem; }
        .result-percentage { font-size: 1.2rem; color: #d1fae5; margin-bottom: 0.5rem; }
        .result-time { font-size: 1rem; color: #a7f3d0; margin-bottom: 1rem; }
        
        .result-saved {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            display: none;
        }
        .result-saved.show { display: block; }
        
        .restart-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #064e3b;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lora', serif;
        }
        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
        }
        
        .home-btn {
            display: inline-block;
            background: transparent;
            color: #fbbf24;
            border: 2px solid #fbbf24;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            text-decoration: none;
            margin-top: 1rem;
            transition: all 0.3s ease;
            font-family: 'Lora', serif;
        }
        .home-btn:hover { background: #fbbf24; color: #064e3b; }
        
        .screen { display: none; }
        .screen.active { display: block; }

        /* POPUP OVERLAY */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .popup-overlay.active { display: flex; }
        
        .popup-content {
            background: #fbbf24;
            color: #1a1a1a;
            border-radius: 1.5rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: popupIn 0.3s ease;
        }
        
        @keyframes popupIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .popup-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .popup-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 1rem; }
        .popup-title.correct { color: #065f46; }
        .popup-title.incorrect { color: #dc2626; }
        .popup-explanation { font-size: 1rem; line-height: 1.5; margin-bottom: 1.5rem; color: #333; }
        
        .popup-btn {
            background: linear-gradient(to right, #065f46, #0f766e);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            border-radius: 2rem;
            cursor: pointer;
            font-family: 'Lora', serif;
            transition: all 0.3s;
        }
        .popup-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(6, 95, 70, 0.4); }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .question-text { font-size: 1.2rem; }
            .container { padding: 1rem; }
            .quiz-icon { width: 70px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- QUIZ SCREEN -->
        <div id="quizScreen" class="screen active">
            <div class="quiz-header">
                <img src="mekteb_logo.png" alt="MEKTEB" class="quiz-icon">
                <h1>Osnove Islama</h1>
                <p class="subtitle">Ilmihal 1 - Nivo 1A</p>
            </div>
            
            <div class="welcome-msg" id="welcomeMsg"></div>
            
            <div class="progress-info">
                <a href="index.html" class="back-link">‚Üê Poƒçetna</a>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <span id="questionCounter">1/20</span>
            </div>
            
            <div class="question-card">
                <p class="question-text" id="questionText"></p>
                <div class="options" id="optionsContainer"></div>
            </div>
        </div>

        <!-- POPUP -->
        <div class="popup-overlay" id="popupOverlay">
            <div class="popup-content">
                <div class="popup-icon" id="popupIcon">‚úÖ</div>
                <div class="popup-title" id="popupTitle">Taƒçno!</div>
                <div class="popup-explanation" id="popupExplanation"></div>
                <button class="popup-btn" onclick="nextQuestion()">Sljedeƒáe pitanje ‚Üí</button>
            </div>
        </div>
        
        <!-- RESULT SCREEN -->
        <div id="resultScreen" class="screen">
            <div class="quiz-header">
                <img src="mekteb_logo.png" alt="MEKTEB" class="quiz-icon">
                <h1>Osnove Islama</h1>
                <p class="subtitle">Ilmihal 1 - Nivo 1A</p>
            </div>
            
            <div class="result-card">
                <div class="result-emoji" id="resultEmoji">üåü</div>
                <div class="result-message" id="resultMessage">Odliƒçan rezultat!</div>
                <div class="result-score" id="resultScore">0/20</div>
                <div class="result-percentage" id="resultPercentage">0% taƒçnih odgovora</div>
                <div class="result-time" id="resultTime"></div>
                <div class="result-saved" id="resultSaved">‚úÖ Rezultat je spremljen u tvoj Mektebski karton</div>
                <button class="restart-btn" onclick="restartQuiz()">Ponovi kviz</button>
                <a href="index.html" class="home-btn">Poƒçetna</a>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // KONFIGURACIJA
        // =====================================================
        const KVIZ_NAZIV = "1a - Osnove Islama";
        const API_URL = "/wp-json/mekteb/v1";
        
        // =====================================================
        // VARIJABLE
        // =====================================================
        let loggedUser = null;
        let quizStartTime = null;
        let questions = [];
        let currentQuestion = 0;
        let score = 0;

        // =====================================================
        // PITANJA
        // =====================================================
        const allQuestions = [
            {question: "Islam je Allahova vjera objavljena svim poslanicima.", options: ["DA", "NE"], answer: "DA", explanation: "Islam znaƒçi predanost Allahu. To je vjera koju je Uzvi≈°eni Allah objavio svim poslanicima, od Adema, a.s., do Muhammeda, a.s."},
            {question: "Kelimei-≈°ehadet se izgovara samo jednom u ≈æivotu.", options: ["DA", "NE"], answer: "NE", explanation: "Kelimei-≈°ehadet izgovaramo svakodnevno, posebno u namazu. To je na≈°a stalna potvrda pripadnosti islamu."},
            {question: "Selam je islamski pozdrav koji znaƒçi 'Neka je na vas Allahov mir'.", options: ["DA", "NE"], answer: "DA", explanation: "Selam (Es-selamu alejkum) je pozdrav mira kojim se muslimani pozdravljaju."},
            {question: "Muhammed, a.s., je roƒëen u Medini.", options: ["DA", "NE"], answer: "NE", explanation: "Muhammed, a.s., je roƒëen u Mekki 12. rebiul-evvela 571. godine. U Medinu se preselio (hid≈æra) 622. godine."},
            {question: "Imanskih ≈°arta ima ≈°est.", options: ["DA", "NE"], answer: "DA", explanation: "Imanski ≈°arti su ≈°est temeljnih istina vjere: vjerovanje u Allaha, meleke, knjige, poslanike, Sudnji dan i kader."},
            {question: "Islamskih ≈°arta ima pet.", options: ["DA", "NE"], answer: "DA", explanation: "Pet islamskih ≈°arta su: ≈°ehadet, namaz, post, zekat i had≈æ."},
            {question: "Sura El-Fatiha se naziva 'Majka Kur'ana'.", options: ["DA", "NE"], answer: "DA", explanation: "El-Fatiha je prva sura u Kur'anu i naziva se 'Ummul-Kur'an' (Majka Kur'ana)."},
            {question: "Bismilla se uƒçi samo prije jela.", options: ["DA", "NE"], answer: "NE", explanation: "Bismilla (U ime Allaha) se uƒçi prije svakog posla, ne samo prije jela."},
            {question: "Ihsan je najveƒái stupanj vjerovanja.", options: ["DA", "NE"], answer: "DA", explanation: "Ihsan je obo≈æavanje Allaha kao da Ga vidi≈°, jer ako ti Njega ne vidi≈°, On tebe vidi."},
            {question: "Subhaneke se uƒçi na poƒçetku svakog namaza.", options: ["DA", "NE"], answer: "DA", explanation: "Subhaneke je dova kojom veliƒçamo Allaha na poƒçetku namaza, nakon iftitahi-tekbira."},
            {question: "Euzubilla znaƒçi 'U ime Allaha'.", options: ["DA", "NE"], answer: "NE", explanation: "Euzubilla znaƒçi 'Tra≈æim Allahovu za≈°titu od prokletog ≈°ejtana'. 'U ime Allaha' je Bismilla."},
            {question: "Allah je stvorio ƒçovjeka kao najsavr≈°enije stvorenje.", options: ["DA", "NE"], answer: "DA", explanation: "ƒåovjek je Allahovo najodabranije i najsavr≈°enije stvorenje."},
            {question: "Mekteb je mjesto gdje uƒçimo o islamskim propisima.", options: ["DA", "NE"], answer: "DA", explanation: "Mekteb je islamska ≈°kola gdje djeca uƒçe o vjeri, Kur'anu i namazu."},
            {question: "Sura El-Ihlas vrijedi kao treƒáina Kur'ana.", options: ["DA", "NE"], answer: "DA", explanation: "Muhammed, a.s., je rekao da sura El-Ihlas vrijedi kao treƒáina Kur'ana."},
            {question: "Dinskih ≈°arta ima trideset i tri.", options: ["DA", "NE"], answer: "DA", explanation: "Dinskih ≈°arta ima 33: 6 imanskih, 5 islamskih, 4 abdestka, 3 tejemumska, 3 gusulska i 12 namaskih."},
            {question: "Koliko ima imanskih ≈°arta?", options: ["Pet", "≈†est", "Sedam", "Deset"], answer: "≈†est", explanation: "Imanskih ≈°arta ima ≈°est: vjerovanje u Allaha, meleke, knjige, poslanike, Sudnji dan i kader."},
            {question: "Kako glasi islamski pozdrav?", options: ["Merhaba", "Es-selamu alejkum", "Zdravo", "Dobar dan"], answer: "Es-selamu alejkum", explanation: "Es-selamu alejkum znaƒçi 'Neka je na vas Allahov mir'."},
            {question: "Koja sura se uƒçi u svakom rekatu namaza?", options: ["El-Ihlas", "El-Fatiha", "En-Nas", "El-Felek"], answer: "El-Fatiha", explanation: "Sura El-Fatiha se uƒçi u svakom rekatu namaza."},
            {question: "Gdje je roƒëen Muhammed, a.s.?", options: ["Medina", "Jeruzalem", "Mekka", "Taif"], answer: "Mekka", explanation: "Muhammed, a.s., je roƒëen u Mekki 571. godine."},
            {question: "≈†ta znaƒçi rijeƒç 'Islam'?", options: ["Ljubav", "Predanost Allahu", "Znanje", "Putovanje"], answer: "Predanost Allahu", explanation: "Islam znaƒçi predanost, pokornost i mir."},
            {question: "Koji je prvi islamski ≈°art?", options: ["Namaz", "Post", "≈†ehadet", "Zekat"], answer: "≈†ehadet", explanation: "≈†ehadet je prvi islamski ≈°art - svjedoƒçenje vjere."},
            {question: "Kako se zove Allahova knjiga objavljena Muhammedu, a.s.?", options: ["Tevrat", "Zebur", "Ind≈æil", "Kur'an"], answer: "Kur'an", explanation: "Kur'an je posljednja Allahova knjiga."},
            {question: "≈†ta uƒçimo kada se divimo neƒçemu lijepom?", options: ["Subhanallah", "Ma≈°allah", "In≈°allah", "Estagfirullah"], answer: "Ma≈°allah", explanation: "Ma≈°allah ka≈æemo kada se divimo neƒçemu lijepom."},
            {question: "Ko je majka Muhammeda, a.s.?", options: ["Hatid≈æa", "Amina", "Fatima", "Ai≈°a"], answer: "Amina", explanation: "Majka Muhammeda, a.s., bila je Amina."},
            {question: "≈†ta znaƒçi 'D≈æelle ≈°anuhu'?", options: ["Neka je mir na njega", "Uzvi≈°eni", "Milostivi", "Svemoguƒái"], answer: "Uzvi≈°eni", explanation: "'D≈æelle ≈°anuhu' znaƒçi 'Uzvi≈°en je On'."},
            {question: "IZBACI ULJEZA: Koja rijeƒç ne pripada islamskim izrazima?", options: ["Bismilla", "Ma≈°allah", "In≈°allah", "Hvala"], answer: "Hvala", explanation: "'Hvala' je obiƒçna rijeƒç, dok su ostale islamski izrazi."},
            {question: "IZBACI ULJEZA: ≈†ta od navedenog NIJE imanski ≈°art?", options: ["Vjerovanje u Allaha", "Vjerovanje u meleke", "Namaz", "Vjerovanje u Sudnji dan"], answer: "Namaz", explanation: "Namaz je ISLAMSKI ≈°art, ne imanski."},
            {question: "ANALOGIJA: Ako je Bismilla poƒçetak, ≈°ta je El-hamdu lillah?", options: ["Kraj", "Zahvala", "Poƒçetak", "Molba"], answer: "Zahvala", explanation: "Bismilla je za poƒçetak, El-hamdu lillah je zahvala."},
            {question: "ANALOGIJA: Ako je Mekka rodno mjesto Poslanika, ≈°ta je Medina?", options: ["Mjesto smrti", "Mjesto hid≈ære", "Mjesto objave", "Sveti grad"], answer: "Mjesto hid≈ære", explanation: "Medina je grad hid≈ære 622. godine."},
            {question: "KO SAM JA? Ja sam prvi islamski ≈°art. Izgovaram se pri prihvatanju islama.", options: ["Namaz", "≈†ehadet", "Post", "Zekat"], answer: "≈†ehadet", explanation: "≈†ehadet je svjedoƒçenje vjere."},
            {question: "KO SAM JA? Ja sam grad u Arabiji. U meni je roƒëen Muhammed, a.s.", options: ["Medina", "Mekka", "Jeruzalem", "Taif"], answer: "Mekka", explanation: "Mekka je rodno mjesto Muhammeda, a.s."},
            {question: "≈†TA SAM JA? Ja sam prva sura u Kur'anu. Imam sedam ajeta.", options: ["El-Bekare", "El-Ihlas", "El-Fatiha", "En-Nas"], answer: "El-Fatiha", explanation: "El-Fatiha je prva sura sa 7 ajeta."},
            {question: "KO SAM JA? Ja sam melek. Donosio sam objavu poslanicima.", options: ["Mikail", "D≈æibril", "Israfil", "Azrail"], answer: "D≈æibril", explanation: "D≈æibril je melek koji donosi objavu."},
            {question: "≈†TA SAM JA? Ja sam dova na poƒçetku namaza. Poƒçinjem rijeƒçima 'Subhaneke'.", options: ["Fatiha", "Subhaneke", "Et-Tehijatu", "Salavati"], answer: "Subhaneke", explanation: "Subhaneke je dova na poƒçetku namaza."},
            {question: "DOPUNI NIZ: ≈†ehadet, namaz, post, zekat, ...?", options: ["Iman", "Had≈æ", "Ihsan", "Sadaka"], answer: "Had≈æ", explanation: "Pet islamskih ≈°arta zavr≈°ava had≈æom."},
            {question: "DOPUNI NIZ: Tevrat, Zebur, Ind≈æil, ...?", options: ["Suhuf", "Kur'an", "Hadis", "Fikh"], answer: "Kur'an", explanation: "ƒåetiri velike knjige: Tevrat, Zebur, Ind≈æil, Kur'an."},
            {question: "DOPUNI NIZ: Allah, meleki, knjige, poslanici, Sudnji dan, ...?", options: ["Namaz", "Kader", "Post", "Zekat"], answer: "Kader", explanation: "≈†est imanskih ≈°arta zavr≈°ava kaderom."},
            {question: "DOPUNI NIZ: Subhaneke, Euzubilla, Bismilla, Fatiha, ...?", options: ["Et-Tehijatu", "Sura", "Selam", "Salavat"], answer: "Sura", explanation: "Poslije Fatihe uƒçi se sura."},
            {question: "SITUACIJA: Ahmed vidi prekrasan cvijet. ≈†ta treba reƒái?", options: ["In≈°allah", "Ma≈°allah", "Estagfirullah", "Bismillah"], answer: "Ma≈°allah", explanation: "Ma≈°allah ka≈æemo za ne≈°to lijepo."},
            {question: "SITUACIJA: Merjem planira sutra posjetiti baku. ≈†ta treba reƒái?", options: ["Ma≈°allah", "Subhanallah", "In≈°allah", "El-hamdu lillah"], answer: "In≈°allah", explanation: "In≈°allah ka≈æemo za buduƒáe planove."},
            {question: "SITUACIJA: Hasan je upravo polo≈æio ispit. ≈†ta treba reƒái?", options: ["In≈°allah", "Estagfirullah", "El-hamdu lillah", "Bismillah"], answer: "El-hamdu lillah", explanation: "El-hamdu lillah je zahvala Allahu."},
            {question: "SITUACIJA: Selma poƒçinje uƒçiti lekciju. ≈†ta treba prouƒçiti?", options: ["El-hamdu lillah", "Ma≈°allah", "Euzubillu i Bismillu", "Salavate"], answer: "Euzubillu i Bismillu", explanation: "Prije uƒçenja prouƒçimo Euzubillu i Bismillu."},
            {question: "SITUACIJA: Emir ƒçuje da je neko kihnuo. ≈†ta treba reƒái?", options: ["Ma≈°allah", "Jerhamukellah", "In≈°allah", "Subhanallah"], answer: "Jerhamukellah", explanation: "Jerhamukellah ka≈æemo onome ko kihne."}
        ];

        // =====================================================
        // INICIJALIZACIJA
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            // Provjeri da li je korisnik prijavljen
            const userData = localStorage.getItem('mektebUser');
            if (userData) {
                loggedUser = JSON.parse(userData);
                document.getElementById('welcomeMsg').textContent = `Dobrodo≈°ao/la, ${loggedUser.name}! üåü`;
                document.getElementById('welcomeMsg').classList.add('show');
            }
            
            // Pokreni kviz
            quizStartTime = new Date();
            initQuiz();
        });

        // =====================================================
        // KVIZ FUNKCIJE
        // =====================================================
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function initQuiz() {
            questions = shuffleArray(allQuestions).slice(0, 20);
            questions.forEach(q => {
                if (q.options.length > 2) {
                    const correctAnswer = q.answer;
                    q.options = shuffleArray(q.options);
                    q.answer = correctAnswer;
                }
            });
            currentQuestion = 0;
            score = 0;
            document.getElementById('quizScreen').classList.add('active');
            document.getElementById('resultScreen').classList.remove('active');
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQuestion];
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${questions.length}`;
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('progressBar').style.width = `${(currentQuestion / questions.length) * 100}%`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function selectAnswer(selected) {
            const q = questions[currentQuestion];
            const isCorrect = selected === q.answer;
            if (isCorrect) score++;
            
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === selected) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                } else if (btn.textContent === q.answer) {
                    btn.classList.add('show-correct');
                } else {
                    btn.classList.add('faded');
                }
            });
            
            showPopup(isCorrect, q.explanation);
        }

        function showPopup(isCorrect, explanation) {
            document.getElementById('popupIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('popupTitle').textContent = isCorrect ? 'Taƒçno!' : 'Netaƒçno!';
            document.getElementById('popupTitle').className = 'popup-title ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('popupExplanation').textContent = explanation;
            document.getElementById('popupOverlay').classList.add('active');
        }

        function nextQuestion() {
            document.getElementById('popupOverlay').classList.remove('active');
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            const percentage = Math.round((score / questions.length) * 100);
            const duration = Math.round((new Date() - quizStartTime) / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            
            let message, emoji;
            if (percentage >= 90) { message = 'Izvrsno! Mashallah!'; emoji = 'üåü'; }
            else if (percentage >= 70) { message = 'Vrlo dobro!'; emoji = '‚ú®'; }
            else if (percentage >= 50) { message = 'Dobro! Nastavi uƒçiti.'; emoji = 'üìö'; }
            else { message = 'Potrebno je vi≈°e uƒçenja.'; emoji = 'üí™'; }
            
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultScore').textContent = `${score}/${questions.length}`;
            document.getElementById('resultPercentage').textContent = `${percentage}% taƒçnih odgovora`;
            document.getElementById('resultTime').textContent = `Vrijeme: ${minutes}m ${seconds}s`;
            
            // Spremi rezultat samo ako je korisnik prijavljen
            if (loggedUser) {
                saveResult(score, questions.length, duration);
            }
        }

        // =====================================================
        // SPREMANJE REZULTATA
        // =====================================================
        function saveResult(bodovi, ukupno, trajanje) {
            const resultSaved = document.getElementById('resultSaved');
            
            fetch(API_URL + '/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: loggedUser.id,
                    quiz: KVIZ_NAZIV,
                    score: bodovi,
                    total: ukupno,
                    time: trajanje
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultSaved.innerHTML = '‚úÖ Rezultat je spremljen u tvoj Mektebski karton';
                    resultSaved.classList.add('show');
                }
            })
            .catch(error => {
                console.error('Save error:', error);
            });
        }

        function restartQuiz() {
            quizStartTime = new Date();
            document.getElementById('resultSaved').classList.remove('show');
            initQuiz();
        }
    </script>
</body>
</html>
